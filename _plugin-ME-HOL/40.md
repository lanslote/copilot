---
title: 4. 포켓몬 플러그인 만들기
layout: default
nav_enabled: true
nav_order: 40
has_toc: true
has_children: true
---

# 포켓몬 플러그인 만들어서 배포하기
{: .no_toc }

<details open markdown="block">
  <summary>
    Table of contents
  </summary>
  {: .text-delta }
- TOC
{:toc}
</details>

---

## 1. 템플릿을 이용하여 프로젝트 만들기
![*******](../assets/40/40-01.png)

![*******](../assets/40/40-02.png)

![*******](../assets/40/40-03.png)

![*******](../assets/40/40-04.png)

![*******](../assets/40/40-05.png)

![*******](../assets/40/40-06.png)

![*******](../assets/40/40-07.png)



## 2. 포켓몬 플러그인으로 코드 수정

### 2-1. searchApp.js 수정

![*******](../assets/40/40-08.png)

![*******](../assets/40/40-09.png)

```js
const pokemonCard = require("./adaptiveCards/pokemonCard.json");
const { Console } = require("console");
const { type } = require("os");
```

![*******](../assets/40/40-10.png)



```js
function search(nameKey, myArray, returnVal){
  for (let i=0; i < myArray.length; i++) {
      if (myArray[i].name === nameKey) {
        if (returnVal){
          return myArray[i].value;
        }
        else{
          return myArray[i];
        }
      }
  }
}

function timestamp(){
  var today = new Date();
  today.setHours(today.getHours() + 9);
  return today.toISOString().replace('T', ' ').substring(0, 19);
}
```

![*******](../assets/40/40-11.png)

```js
class SearchApp extends TeamsActivityHandler {
  constructor() {
    super();
  }

  // Message extension Code
  // Search.
  async handleTeamsMessagingExtensionQuery(context, query) {
    //const searchQuery = query.parameters[0].value;
    console.log(search('poke_name', query.parameters, false));
    console.log(search('poke_type', query.parameters, false));
    console.log(timestamp());
    
    let poke_name = "", poke_type = "";
    if (search('poke_name', query.parameters, false)){
      poke_name = search('poke_name', query.parameters, false).value;
    }
    if (search('poke_type', query.parameters, false)){
      poke_type = search('poke_type', query.parameters, false).value;
    }

    //주소 변경 필요
    const response = await axios.get(
      `https://**************.azurewebsites.net/api/**********?${querystring.stringify({
        name: poke_name,
        type: poke_type,
      })}`
    );

    const attachments = [];
    response.data.pokemons.forEach((pokemon) => {
      const evols = [];
      if (pokemon.prev_evolution){
        pokemon.prev_evolution.forEach((evol) => {
          evols.push(evol);
        })
      }
      evols.push({
        "num":pokemon.num,
        "name":pokemon.name
      });
      if (pokemon.next_evolution){
        pokemon.next_evolution.forEach((evol) => {
          evols.push(evol);
        })
      }

      let temp_evolimg1 = "", temp_evolimg2 = "", temp_evolimg3 = "", temp_evolimg4 = ""
      let temp_evolname1 = "", temp_evolname2 = "", temp_evolname3 = "", temp_evolname4 = "";
      if (evols[0]) {
        temp_evolimg1 = "http://www.serebii.net/pokemongo/pokemon/" + evols[0].num + ".png";
        temp_evolname1 = evols[0].name;
      }
      if (evols[1]) {
        temp_evolimg2 = "http://www.serebii.net/pokemongo/pokemon/" + evols[1].num + ".png";
        temp_evolname2 = evols[1].name;
      }
      if (evols[2]) {
        temp_evolimg3 = "http://www.serebii.net/pokemongo/pokemon/" + evols[2].num + ".png";
        temp_evolname3 = evols[2].name;
      }
      if (evols[3]) {
        temp_evolimg4 = "http://www.serebii.net/pokemongo/pokemon/" + evols[3].num + ".png";
        temp_evolname4 = evols[3].name;
      }

      const template = new ACData.Template(pokemonCard);
      const card = template.expand({
        $root: {
          num: pokemon.num,
          name: pokemon.name,
          img: pokemon.img,
          type: pokemon.type,
          height: pokemon.height,
          weight: pokemon.weight,
          candy: pokemon.candy,
          weaknesses: pokemon.weaknesses.join(", "),
          evolimg1: temp_evolimg1,
          evolname1: temp_evolname1,
          evolimg2: temp_evolimg2,
          evolname2: temp_evolname2,
          evolimg3: temp_evolimg3,
          evolname3: temp_evolname3,
          evolimg4: temp_evolimg4,
          evolname4: temp_evolname4,
        },
      });
      const preview = CardFactory.heroCard(pokemon.name);
      const attachment = { ...CardFactory.adaptiveCard(card), preview };
      attachments.push(attachment);
    });

    return {
      composeExtension: {
        type: "result",
        attachmentLayout: "list",
        attachments: attachments,
      },
    };
  }
}
```

### 2-2. pokemonCard.json 추가

![*******](../assets/40/40-12.png)

![*******](../assets/40/40-13.png)


### 2-3. 플러그인 아이콘 파일 준비
![*******](../assets/40/40-14.png)

### 2-3. manifest.json 수정

```json
"icons": {
  "color": "color_ball.png",
  "outline": "outline_ball.png"
},
```


```json
"name": {
  "short": "PokemonME${{APP_NAME_SUFFIX}}",
  "full": "포켓몬 정보 조회 코파일럿 플러그인"
},
```

```json
"description": {
  "short": "포켓몬 정보를 이름과 타입으로 검색합니다.",
  "full": "포켓몬 정보를 이름과 타입으로 검색합니다. \n예) 꼬부기라는 이름의 포켓몬 정보를 찾아줘 \n예) 전기 타입의 포켓몬 정보를 찾아줘"
},
```

```json
"commands": [
  {
    "id": "nameSearch",
    "context": [
        "compose",
        "commandBox"
    ],
    "description": "이름으로 포켓몬을 검색",
    "title": "포켓몬 이름",
    "type": "query",
    "semanticDescription": "이 커맨드는 제공된 이름으로 찾은 포켓몬의 정보를 받습니다.",
    "parameters": [
        {
            "name": "poke_name",
            "title": "포켓몬 이름",
            "description": "검색할 포켓몬의 이름",
            "inputType": "text",
            "semanticDescription": "이 매개변수는 검색할 포켓몬을 식별하기 위한 것입니다. 사용자는 찾고자 하는 포켓몬의 이름을 이 매개변수의 값으로 제공해야 합니다."
        }
    ]
  },
  {
    "id": "typeSearch",
    "context": [
        "compose",
        "commandBox"
    ],
    "description": "타입으로 포켓몬을 검색",
    "title": "포켓몬 타입",
    "type": "query",
    "semanticDescription": "이 커맨드는 제공된 타입으로 찾은 포켓몬의 정보를 받습니다. 예를 들어 '전기 타입인 포켓몬 찾아줘'라고 사용자가 말하면 검색을 원하는 타입이 '전기'입니다",
    "parameters": [
        {
            "name": "poke_type",
            "title": "포켓몬 타입",
            "description": "검색할 포켓몬의 타입",
            "inputType": "text",
            "semanticDescription": "이 매개변수는 검색할 포켓몬을 식별하기 위한 것입니다. 사용자는 찾고자 하는 포켓몬의 타입을 이 매개변수의 값으로 제공해야 합니다."
        }
    ]
  }
]
```


## 3. 포켓몬 플러그인 테스트
![*******](../assets/40/40-15.png)

![*******](../assets/40/40-16.png)

![*******](../assets/40/40-17.png)

![*******](../assets/40/40-18.png)

![*******](../assets/40/40-19.png)

![*******](../assets/40/40-20.png)

![*******](../assets/40/40-21.png)

![*******](../assets/40/40-22.png)

![*******](../assets/40/40-23.png)

![*******](../assets/40/40-24.png)

![*******](../assets/40/40-25.png)

![*******](../assets/40/40-26.png)

![*******](../assets/40/40-27.png)

![*******](../assets/40/40-28.png)





## 4. 포켓몬 플러그인을 클라우드에 배포

### 4-1. 팀즈 툴킷을 프리릴리즈 버전으로 전환
![*******](../assets/40/40-29.png)

### 4-2. 팀즈 툴킷의 Azure 구독 계정 로그인
![*******](../assets/40/40-30.png)

![*******](../assets/40/40-31.png)

![*******](../assets/40/40-32.png)

![*******](../assets/40/40-33.png)

![*******](../assets/40/40-34.png)



### 4-2. 플러그인을 클라우드에 프로비전
![*******](../assets/40/40-35.png)

![*******](../assets/40/40-36.png)

![*******](../assets/40/40-37.png)

![*******](../assets/40/40-38.png)

![*******](../assets/40/40-39.png)


### 4-3. 플러그인을 클라우드에 배포
![*******](../assets/40/40-40.png)

![*******](../assets/40/40-41.png)


### 4-4. 플러그인 테스트
![*******](../assets/40/40-42.png)

![*******](../assets/40/40-43.png)

![*******](../assets/40/40-44.png)


## 5. [중요] 배포된 플러그인 앱 비용관리

![*******](../assets/40/40-45.png)

![*******](../assets/40/40-46.png)

![*******](../assets/40/40-47.png)

![*******](../assets/40/40-48.png)

![*******](../assets/40/40-49.png)

![*******](../assets/40/40-50.png)

![*******](../assets/40/40-51.png)

![*******](../assets/40/40-52.png)

![*******](../assets/40/40-53.png)

![*******](../assets/40/40-54.png)

